# PyStock Backtester - 台股策略回測工具

這是一款使用 Python 語言開發的桌面應用程式，專為台灣股市設計，提供一個圖形化的介面，讓使用者能夠方便快速地回測各種量化交易策略。

![App Screenshot](placeholder.png)
*(請替換此處的 `placeholder.png` 為您的應用程式截圖)*

---

## 功能亮點

- **圖形化操作介面**：基於 PyQt5 開發，介面直觀，操作簡單。
- **自動化資料取得**：使用 `yfinance` 自動從 Yahoo Finance 下載最新的台股歷史日 K 資料。
- **多元化內建策略**：內建了數十種基於常用技術指標的交易策略，例如：
    - 移動平均線 (MA) 交叉
    - RSI + MACD + SMA 組合策略
    - DMI, KDJ, ROC, MFI 等指標應用
    - 可擴充的自定義策略框架
- **視覺化回測結果**：使用 `mplfinance` 繪製 K 線圖，並在圖上直接標示出買賣點，讓策略行為一目了然。
- **精細的績效報告**：提供詳盡的關鍵績效指標 (KPI) 報表，並已為您**計入台灣股市的交易成本** (手續費與證交稅)，讓評估結果更貼近真實。

---

## 關鍵績效指標 (KPI)

本工具會計算以下指標來評估策略表現：

| 指標名稱 | 說明 |
| :--- | :--- |
| **交易次數** | 在回測期間內的總交易次數。 |
| **總報酬** | 扣除所有交易成本後的淨利潤。 |
| **投入成本** | 每次買入的總花費累加。 |
| **勝率** | 獲利次數佔總交易次數的百分比。 |
| **獲利因子** | 總獲利金額 / 總虧損金額。 |
| **賺賠比** | 平均單筆獲利 / 平均單筆虧損。 |
| **最大資金回落 (MDD)** | 衡量策略可能面臨的最大風險。 |
| **成功/虧損次數** | 分別統計獲利與虧損的交易筆數。 |
| **總獲利/虧損金額** | 分別統計獲利與虧損的總金額。 |
| **平均獲利/虧損金額** | 分別統計單筆交易的平均獲利與虧損。 |
| **最大單筆獲利/虧損** | 回測期間內，單次交易所獲得的最大利潤與虧損。 |

---

## 技術棧

- **核心語言**: Python 3
- **圖形介面 (GUI)**: PyQt5
- **資料獲取**: yfinance
- **技術分析**: TA-Lib
- **圖表繪製**: mplfinance
- **資料處理**: pandas

---

## 如何安裝與執行

**1. 前置需求**

- 請先安裝 Python 3.x。
- TA-Lib 函式庫需要預先安裝其底層 C 語言程式庫。請參考 [官方文件](https://github.com/mrjbq7/ta-lib#installation) 根據您的作業系統進行安裝。

**2. 安裝 Python 函式庫**

在您的終端機或命令提示字元中，移動到專案的根目錄下，然後執行以下指令來安裝所有必要的 Python 套件：

```bash
pip install -r requirements.txt
```

**3. 執行應用程式**

安裝完成後，執行以下指令來啟動程式：

```bash
python stock_strategy_UI.py
```

---

## 使用教學

1.  啟動應用程式。
2.  在「請輸入股票代號」欄位中，輸入您想回測的台股代號 (例如: 2330, 0050)。
3.  在「回測月數」欄位中，輸入您想回測的歷史期間長度 (以月為單位)。
4.  在「選擇策略」區塊中，點選您想測試的交易策略。
5.  點擊「回測」按鈕。
6.  程式將會開始下載資料並執行運算，完成後您將會在上方看到 K 線圖與買賣點，下方看到詳細的績效報表。

---

## 專案結構

```
/
├── stock_strategy_UI.py    # 主程式，負責 UI 介面與商業邏輯
├── stock_UI.ui             # PyQt5 Designer 產生的 UI 佈局文件
├── yF_Kbar.py              # 負責從 Yahoo Finance 抓取資料並繪製 K 線圖
├── KPI.py                  # 負責計算所有策略的績效指標
├── requirements.txt        # 專案所需的 Python 函式庫列表
├── *_strategy.py           # 各種以 `_strategy.py` 結尾的策略文件
├── icon/                   # 存放 UI 所需的圖示
└── stockImg/               # 存放程式產生的 K 線圖圖片
```
